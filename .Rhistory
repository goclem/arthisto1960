Reduce(function(x, y) c(setdiff(x, y), setdiff(y, x)), l, l)
l <- list(c(1, 2, 3), c(1, 2), c(1, 3, 4))
Reduce(function(x, y) c(setdiff(x, y), setdiff(y, x)), l, l)
pacman::p_load(readxl)
read_xlsx("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simon.xlsx")
data <- read_xlsx("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simon.xlsx")
data
data$`Hours worked`
str_split(data$`Hours worked`, "H|h")
pacman::p_load(readxl, stringr)
str_split(data$`Hours worked`, "H|h")
hours <- str_split(data$`Hours worked`, "H|h")
data  <- read_xlsx("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simon.xlsx")
hours <- str_split(data$`Hours worked`, "H|h")
hours
data  <- read_xlsx("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simon.xlsx")
hours <- do.call(rbind, str_split(data$`Hours worked`, "H|h"))
hours
hours[, 1]
as.numeric(hours[, 1])
as.numeric(hours[, 2])
as.numeric(hours[, 2]) / 60
hours
hours[, 2]
hours[is.na(hours)]
hours[hours==""]
data  <- read_xlsx("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simon.xlsx")
hours <- do.call(rbind, str_split(data$`Hours worked`, "H|h"))
hours[hours==""] <- "0"
hours
as.numeric(hours[, 1]) + as.numeric(hours[, 2]) / 60
data$`Hours worked` <- as.numeric(hours[, 1]) + as.numeric(hours[, 2]) / 60
data
write.csv(data, "/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simon.csv", sep = ";")
write.csv
?write.csv
write.csv(data, "/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simon.csv", sep = ";")
write.table(data, "/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simon.csv", sep = ";")
data$`Hours worked`
sum(data$`Hours worked`)
90 - sum(data$`Hours worked`)
pacman::p_load(sf)
vecs <- st_read("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/vannes/0250_6745/label_0250_6745.gpkg")
vecs
table(st_is_valid(vecs))
nrow(vecs)
pacman::p_load(sf)
vecs <- st_read("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/vannes/0250_6745/label_0250_6745.gpkg")
table(st_is_empty(vecs))
pacman::p_load(sf, dplyr)
vecs <- filter(vecs, !st_is_empty(vecs))
vecs
st_write(vecs, "/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/vannes/0250_6745/label_0250_6745.gpkg")
st_write(vecs, "/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/vannes/0250_6745/label_0250_6745.gpkg", delete_dsn = T)
pacman::p_load(sf, dplyr)
vecs <- st_read("/Users/clementgorin/Dropbox/research/arthisto/shared_data/landuse18602020/qgis_roads18602020/layers/roads2020.gpkg")
head(vecs)
table(vecs$VOCATION)
pacman::p_load(sf, dplyr, readxl)
read_xlsx("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/transport1860/remi/schedule_remi.xlsx")
x <- read_xlsx("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/transport1860/remi/schedule_remi.xlsx")
x
x$`Hours worked`
sum(x$`Hours worked`)
sum(!is.na(x$`Hours worked`))
pacman::p_load(sf, dplyr, readxl, data.table)
fread("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simeon.csv")
fread("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simeon.csv")
fread("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simeon.csv")
fread
x <- fread("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/schedule_simeon.csv")
sum(x$`Hours worked`)
pacman::p_load(raster)
raster("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/lyon/0825_6520/image_0825_6520.tif")
rst <- raster("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/lyon/0825_6520/image_0825_6520.tif")
extent(rst)
extent
?extent
as(extent(rst), 'SpatialPolygons')
as(extent(rst), 'SpatialPolygons', crs = 2154)
pacman::p_load(raster, sf)
st_as_sf(as(extent(rst), 'SpatialPolygons')  )
st_as_sf(as(extent(rst), 'SpatialPolygons') , crs=2154)
ext <- st_as_sf(as(extent(rst), 'SpatialPolygons'))
ext <- st_set_crs(ext, 2154)
ext
st_write(ext, "~/Desktop/ext.gpkg")
vecs <- st_read("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/lyon/0825_6520/label_0825_6520.gpkg")
vecs
ref <- st_read("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/0650_6870/label_0650_6870.gpkg")
ref
vecs
pacman::p_load(raster, sf, dplyr)
vecs <- mutate(vecs, class = 4, comment = '')
vecs
ref <- st_read("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/paris/0650_6870/label_0650_6870.gpkg")
ref
vecs <- st_read("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/lyon/0825_6520/label_0825_6520.gpkg")
vecs <- mutate(vecs, class = 4, comment = '')
vecs
vecs <- select(vecs, class, comment, geom)
vecs
st_write(vecs, "/Users/clementgorin/Dropbox/research/arthisto/shared_ras/training1960/lyon/0825_6520/label_0825_6520.gpkg", delete_dsn = T)
pacman::p_load(sf)
vecs <- st_read("/Users/clementgorin/Dropbox/research/arthisto/shared_ras/landuse18602015/data/route5002020/route5002020_emprisesol.gpkg")
sum(st_area(vecs))
area <- sum(st_area(vecs))
area
france <- st_read("/Users/clementgorin/Dropbox/research/arthisto/data_project/france2015.gpkg")
area_fr <- st_area(france)
area_fr
area / area_fr * 100
corine <- st_read("/Users/clementgorin/Dropbox/data/eea_corine2018/clc18.gpkg")
pacman::p_load(sf, dplyr)
corine <- filter(corine, code_18 %in% c(111,112,121 ,123,124,133))
corine
corine
area_artif <- st_area(corine)
area_artif
area_artif <- sum(st_area(corine))
area_artif
area_artif / area_fr * 100
corine
corine <- filter(corine, code_18 %in% c(111,112,121 ,123,124,133)) %>%
group_by(code_18)  %>%
group_split()
length(corine)
areas_artif <- sapply(corine, function(.) sum(st_area(.)))
areas_artif
corine <- st_read("/Users/clementgorin/Dropbox/data/eea_corine2018/clc18.gpkg")
corine <- st_read("/Users/clementgorin/Dropbox/data/eea_corine2018/clc18.gpkg")
area_tot <- sum(st_area(corine))
area_artif <- filter(corine, code_18 %in% c(111,112,121,123,124,133)) %>%
group_by(code_18)  %>%
group_split()
area_artif <- sapply(area_artif, function(.) sum(st_area(.)))
area_artif  / area_tot * 100
cbind( c(111,112,121,123,124,133), area_artif  / area_tot * 100)
sum(area_artif)
sum(area_artif) / area_tot * 100
pacman::p_load(raster)
ca1000 <- raster("~/Dropbox/research/arthisto/shared_data/project/ca1000.tif")
ca1000 <- raster("~/Dropbox/research/arthisto/shared_data/project/ca1000.tif")
plot(ca1000)
ca1000
values(ca1000)
build1000 <- ca1000
build1000[is.na(build1000)] <- 0
plot(build1000)
?mask
build1000 <- mask(build1000, ca1000)
plot(build1000)
?writeRaster
ca1000 <- raster("~/Dropbox/research/arthisto/shared_data/project/ca1000.tif")
pacman::p_load(raster)
ca1000 <- raster("~/Dropbox/research/arthisto/shared_data/project/ca1000.tif")
ca1000
ca1000[is.na(ca1000)] <- 0
ca1000
ca1000[!is.na(ca1000)] <- 1
plot(ca1000)
ca1000 <- raster("~/Dropbox/research/arthisto/shared_data/project/ca1000.tif")
ca1000[!is.na(ca1000)] <- 1
ca1000[is.na(ca1000)]  <- 0
plot(ca1000)
tiles <- st_read("/Users/clementgorin/Dropbox/research/arthisto/data_1960/tiles/tiles_1960.gpkg")
pacman::p_load(sf)
tiles <- st_read("/Users/clementgorin/Dropbox/research/arthisto/data_1960/tiles/tiles_1960.gpkg")
tiles
pacman::p_load(sf, dplyr)
dir("/Users/clementgorin/Dropbox/research/arthisto/data_1960/labels")
pacman::p_load(sf, dplyr, stringr)
str_extract(dir("/Users/clementgorin/Dropbox/research/arthisto/data_1960/labels"), "\\d{4}_\\d{4}")
tiles <- filter(tiles, tile %in% str_extract(dir("/Users/clementgorin/Dropbox/research/arthisto/data_1960/labels"), "\\d{4}_\\d{4}"))
tiles
st_write(tiles, "/Users/clementgorin/Dropbox/research/arthisto/data_1960/tiles/training_1960.gpkg", delete_dsn = T)
st_write(tiles, "/Users/clementgorin/Dropbox/research/arthisto/data_1960/tiles/training_1960.gpkg", delete_dsn = T)
pacman::p_load(sf)
vecs <- st_read("/Users/clementgorin/Dropbox/research/arthisto/shared_data/1760/vectors/parishes_centers/parishes_centers.shp")
table(vecs$cat)
names(table(vecs$cat))
paste(names(table(vecs$cat)), collapse = "\n")
cat(paste(names(table(vecs$cat)), collapse = "\n"))
pacman::p_load("/Users/clementgorin/Dropbox/jordan_coverage/data/Afrobarometer_gps_individuals.csv")
pacman::p_load(data.table)
fread("/Users/clementgorin/Dropbox/jordan_coverage/data/Afrobarometer_gps_individuals.csv")
afrobarometer <- fread("/Users/clementgorin/Dropbox/jordan_coverage/data/Afrobarometer_gps_individuals.csv")
afrobarometer
afrobarometer <- st_as_sf(afrobarometer, coords = c("longitude", "latitude"), crs = 4326)
pacman::p_load(data.table, sf)
afrobarometer <- fread("/Users/clementgorin/Dropbox/jordan_coverage/data/Afrobarometer_gps_individuals.csv")
afrobarometer <- st_as_sf(afrobarometer, coords = c("longitude", "latitude"), crs = 4326)
st_write(afrobarometer, "~/Dropbox/jordan_coverage/data/Afrobarometer.gpkg")
constituencies <- st_read("~/Dropbox/jordan_coverage/data/constituencies/constituencies.gpkg")
constituencies
st_join(afrobarometer, constituencies)
afrobarometer  <- st_transform(3857)
afrobarometer  <- fread("~/Dropbox/jordan_coverage/data/Afrobarometer_gps_individuals.csv")
afrobarometer  <- st_as_sf(afrobarometer, coords = c("longitude", "latitude"), crs = 4326)
afrobarometer  <- st_transform(afrobarometer, 3857)
afrobarometer
constituencies <- st_read("~/Dropbox/jordan_coverage/data/constituencies/constituencies.gpkg")
constituencies
test <- st_join(afrobarometer, constituencies)
test
afrobarometer
st_join
test <- st_join(afrobarometer, constituencies, join = st_within)
test
afrobarometer
any(duplicated(afrobarometer$respno))
any(duplicated(test$respno))
test
test[duplicated(test$respno) | duplicated(test$respno, fromLast = T), ]
test           <- st_join(afrobarometer, constituencies, join = st_within)
test           <- test[duplicated(test$respno) | duplicated(test$respno, fromLast = T), ]
test
st_write(test, "~/Desktop/test.gpkg")
afrobarometer  <- fread("~/Dropbox/jordan_coverage/data/Afrobarometer_gps_individuals.csv")
afrobarometer  <- st_as_sf(afrobarometer, coords = c("longitude", "latitude"), crs = 4326)
afrobarometer  <- st_transform(afrobarometer, 3857)
constituencies <- st_read("~/Dropbox/jordan_coverage/data/constituencies/constituencies.gpkg")
test           <- st_join(afrobarometer, constituencies)
afrobarometer  <- fread("~/Dropbox/jordan_coverage/data/Afrobarometer_gps_individuals.csv")
afrobarometer  <- st_as_sf(afrobarometer, coords = c("longitude", "latitude"), crs = 4326)
afrobarometer  <- st_transform(afrobarometer, 3857)
constituencies <- st_read("~/Dropbox/jordan_coverage/data/constituencies/constituencies.gpkg")
afrobarometer  <- st_join(afrobarometer, constituencies)
afrobarometer
afrobarometer  <- mutate(duplicated = duplicated(respno) | duplicated(respno, fromLast = T))
pacman::p_load(data.table, sf, dplyr)
afrobarometer  <- fread("~/Dropbox/jordan_coverage/data/Afrobarometer_gps_individuals.csv")
afrobarometer  <- st_as_sf(afrobarometer, coords = c("longitude", "latitude"), crs = 4326)
afrobarometer  <- st_transform(afrobarometer, 3857)
constituencies <- st_read("~/Dropbox/jordan_coverage/data/constituencies/constituencies.gpkg")
afrobarometer  <- st_join(afrobarometer, constituencies)
afrobarometer  <- mutate(duplicated = duplicated(respno) | duplicated(respno, fromLast = T))
afrobarometer
afrobarometer  <- fread("~/Dropbox/jordan_coverage/data/Afrobarometer_gps_individuals.csv")
afrobarometer  <- st_as_sf(afrobarometer, coords = c("longitude", "latitude"), crs = 4326)
afrobarometer  <- st_transform(afrobarometer, 3857)
constituencies <- st_read("~/Dropbox/jordan_coverage/data/constituencies/constituencies.gpkg")
afrobarometer  <- st_join(afrobarometer, constituencies)
afrobarometer  <- mutate(afrobarometer, duplicated = duplicated(respno) | duplicated(respno, fromLast = T))
afrobarometer
table(afrobarometer$duplicated)
afrobarometer  <- mutate(afrobarometer, duplicated = 1 * (duplicated(respno) | duplicated(respno, fromLast = T)))
afrobarometer
afrobarometer  <- mutate(afrobarometer,
duplicated    = 1 * (duplicated(respno) | duplicated(respno, fromLast = T)),
unmatched_cst = 1 * is.na(iso))
afrobarometer
st_write(afrobarometer, "~/Dropbox/jordan_coverage/data/Afrobarometer.gpkg", delete_dsn = T)
fwrite(st_drop_geometry(afrobarometer), "~/Dropbox/jordan_coverage/data/Afrobarometer_constituency.csv")
st_write(afrobarometer, "~/Dropbox/jordan_coverage/data/Afrobarometer_constituencies.gpkg", delete_dsn = T)
fwrite(st_drop_geometry(afrobarometer), "~/Dropbox/jordan_coverage/data/Afrobarometer_constituencies.csv")
dhs <- st_read("/Users/clementgorin/Dropbox/jordan_coverage/data/DHS/DHS_Villages.shp")
dhs
dhs  <- st_transform(dhs, 3857)
dhs
constituencies <- st_read("~/Dropbox/jordan_coverage/data/constituencies/constituencies.gpkg")
constituencies
dhs  <- st_join(dhs, constituencies)
dhs
dhs
dhs  <- mutate(dhs,
duplicated    = 1 * (duplicated(DHSID) | duplicated(DHSID, fromLast = T)),
unmatched_cst = 1 * is.na(iso))
dhs
dim(dhs)
table(dhs$unmatched_cst)
table(dhs$duplicated)
dhs <- st_read("/Users/clementgorin/Dropbox/jordan_coverage/data/DHS/DHS_Villages.shp")
dhs
dim(dhs)
dhs  <- st_transform(dhs, 3857)
constituencies <- st_read("~/Dropbox/jordan_coverage/data/constituencies/constituencies.gpkg")
dhs  <- st_join(dhs, constituencies)
dhs
dim(dhs)
dhs
dhs  <- mutate(dhs,
duplicated    = 1 * (duplicated(DHSID) | duplicated(DHSID, fromLast = T)),
unmatched_cst = 1 * is.na(iso))
dhs
table(dhs$duplicated)
table(dhs$unmatched_cst)
st_write(dhs, "~/Dropbox/jordan_coverage/data/dhs_constituencies.gpkg", delete_dsn = T)
fwrite(st_drop_geometry(dhs), "~/Dropbox/jordan_coverage/data/dhs_constituencies.csv")
pacman::p_load(raster)
raster("/Users/clementgorin/Dropbox/data/cassini/Cassini_001.tif")
rst <- raster("/Users/clementgorin/Dropbox/data/cassini/Cassini_001.tif")
rst
dim(rst)
res(rst)
dim(rst)[-3]
dim(rst)[-3] * res(rst)
round(dim(rst)[-3] * res(rst))
rst <- raster("/Users/clementgorin/Dropbox/data/cassini/Cassini_002.tif")
round(dim(rst)[-3] * res(rst))
dir("/Users/clementgorin/Dropbox/data/cassini")
list.files("~/Dropbox/data/cassini", pattern = "tif$")
list.files("~/Dropbox/data/cassini", pattern = "tif$", full.names = T)
files <- list.files("~/Dropbox/data/cassini", pattern = "tif$", full.names = T)
files <- list.files("~/Dropbox/data/cassini", pattern = "tif$", full.names = T)[:5]
files <- list.files("~/Dropbox/data/cassini", pattern = "tif$", full.names = T)[1:5]
files
sapply(files, function(file) {
map <- raster(file)
ext <- round(dim(map)[-3] * res(map))
return(ext)
})
exts <- sapply(files, function(file) {
map <- raster(file)
ext <- round(dim(map)[-3] * res(map))
return(ext)
})
exts <- Reduce(exts, mean)
exts <- Reduce(mean, exts)
exts
exts <- lapply(files, function(file) {
map <- raster(file)
ext <- round(dim(map)[-3] * res(map))
return(ext)
})
exts
exts <- Reduce(mean, exts)
exts <- lapply(files, function(file) {
map <- raster(file)
ext <- round(dim(map)[-3] * res(map))
return(ext)
})
exts <- do.call(rbind, exts)
exts
colMeans(exts)
round(colMeans(exts))
files <- list.files("~/Dropbox/data/cassini", pattern = "tif$", full.names = T)[1:5]
exts <- lapply(files, function(file) {
map <- raster(file)
ext <- round(dim(map)[-3] * res(map))
return(ext)
})
exts
files <- list.files("~/Dropbox/data/cassini", pattern = "tif$", full.names = T)
exts <- lapply(files, function(file) {
map <- raster(file)
ext <- round(dim(map)[-3] * res(map))
return(ext)
})
files <- list.files("~/Dropbox/data/cassini", pattern = "tif$", full.names = T)
files
round(colMeans(exts))
files <- list.files("~/Dropbox/data/cassini", pattern = "tif$", full.names = T)[1:5]
exts <- lapply(files, function(file) {
map <- raster(file)
ext <- round(dim(map)[-3] * res(map))
return(ext)
})
exts <- do.call(rbind, exts)
round(colMeans(exts))
exts <- lapply(files, function(file) {
map <- raster(file)
#ext <- round(dim(map)[-3] * res(map))
return(dim(map)[-3])
})
exts <- do.call(rbind, exts)
exts
round(colMeans(exts))
pacman::p_load(sf, dplyr)
setwd("~/Dropbox/research/arthisto/arthisto1960")
legends <- st_read("../data_1960/tiles/legends_1960.gpkg", quiet = T)
france  <- st_read("~/Dropbox/data/coutries/countries.gpkg", quiet = T) %>%
filter(CNTR_NAME == "France") %>%
st_transform(2154) %>%
st_geometry()
plot(france)
plot(france)
france  <- st_read("~/Dropbox/data/coutries/countries.gpkg", quiet = T) %>%
filter(CNTR_NAME == "France") %>%
st_transform(2154)
france
france  <- st_read("~/Dropbox/data/coutries/countries.gpkg", quiet = T) %>%
filter(CNTR_NAME == "France") %>%
st_transform(2154) %>%
st_geometry() %>%
st_cast("POLYGON")
france
plot(france[1])
plot(france[2])
plot(france[3])
plot(france[5])
st_area(france)
st_area(france) == max(st_area(france) )
main <- filter(france, st_area(france) == max(st_area(france)))
main <- france[st_area(france) == max(st_area(france))]
main
plot(main)
st_distance(france, main)
options(scipen = 999)
st_distance(france, main)
st_distance(france, main) < 10e3
st_distance(france, main) < units(10e3, "m")
st_distance(france, main) < as_units(10e3, "m")
pacman::p_load(units)
as_units()
st_distance(france, main) < as_units(10e3, "m")
keep <- france[st_area(france) == max(st_area(france))]
keep <- france[st_area(france) == max(st_area(france))]
keep <- st_distance(france, keep) < as_units(1000e3, "m")
keep
france <- filter(france, keep)
france  <- st_read("~/Dropbox/data/coutries/countries.gpkg", quiet = T) %>%
filter(CNTR_NAME == "France") %>%
st_transform(2154) %>%
select(geometry)
france  <- st_read("~/Dropbox/data/coutries/countries.gpkg", quiet = T) %>%
filter(CNTR_NAME == "France") %>%
st_transform(2154) %>%
select(geom)
france
france  <- st_read("~/Dropbox/data/coutries/countries.gpkg", quiet = T) %>%
filter(CNTR_NAME == "France") %>%
st_transform(2154) %>%
select(geom) %>%
st_cast("POLYGON")
france
keep <- filter(france, st_area(france) == max(st_area(france)))
keep
keep <- st_distance(france, keep) < as_units(1000e3, "m")
keep
france <- filter(france, keep)
france
plot(france)
rm(keep)
pacman::p_load(sf, dplyr)
setwd("~/Dropbox/research/arthisto/arthisto1960")
legends <- st_read("../data_1960/tiles/legends_1960.gpkg", quiet = T)
france  <- st_read("~/Dropbox/data/coutries/countries.gpkg", quiet = T)
# France geometries -------------------------------------------------------
france <- france %>%
filter(CNTR_NAME == "France") %>%
st_transform(2154) %>%
select(geom) %>%
st_cast("POLYGON")
keep   <- filter(france, st_area(france) == max(st_area(france)))
keep   <- st_distance(france, keep) < as_units(1000e3, "m")
france <- filter(france, keep)
rm(keep)
legends <- st_intersection(legends, france)
types <- legends %>%
group_by(legend) %>%
summarise() %>%
st_cast("MULTIPOLYGON") %>%
st_cast("POLYGON", warn = F) %>%
st_buffer(1000) %>%
st_buffer(-1000)
st_write(types, "../data_1960/tiles/legends_1960_types.gpkg", delete_dsn = T, quiet = T)
years <- legends %>%
group_by(year) %>%
summarise() %>%
st_cast("MULTIPOLYGON") %>%
st_cast("POLYGON", warn = F) %>%
st_buffer(1000) %>%
st_buffer(-1000)
st_write(years, "../data_1960/tiles/legends_1960_years.gpkg", delete_dsn = T, quiet = T)
12,5
12.5
12.5/8.5
8.5/12.5
3*1.5
8.5
8.5/12.6
8.5*1.5
170*1.5
150/3
150/3*4
150/4*3
112.5/150
112.5/150
pacman::p_load(sf, dplyr)
setwd("~/Dropbox/research/arthisto/arthisto1960")
legends <- st_read("../data_1960/tiles/legends_1960.gpkg", quiet = T)
france  <- st_read("~/Dropbox/data/coutries/countries.gpkg", quiet = T)
# France geometries -------------------------------------------------------
france <- france %>%
filter(CNTR_NAME == "France") %>%
st_transform(2154) %>%
select(geom) %>%
st_cast("POLYGON")
keep   <- filter(france, st_area(france) == max(st_area(france)))
keep   <- st_distance(france, keep) < as_units(1000e3, "m")
france <- filter(france, keep)
rm(keep)
legends <- st_intersection(legends, france)
types <- legends %>%
group_by(legend) %>%
summarise() %>%
st_cast("MULTIPOLYGON") %>%
st_cast("POLYGON", warn = F) %>%
st_buffer(1000) %>%
st_buffer(-1000)
st_write(types, "../data_1960/tiles/types1960.gpkg", delete_dsn = T, quiet = T)
years <- legends %>%
group_by(year) %>%
summarise() %>%
st_cast("MULTIPOLYGON") %>%
st_cast("POLYGON", warn = F) %>%
st_buffer(1000) %>%
st_buffer(-1000)
st_write(years, "../data_1960/tiles/years1960.gpkg", delete_dsn = T, quiet = T)
st_write(types, "../data_1960/tiles/types_1960.gpkg", delete_dsn = T, quiet = T)
st_write(years, "../data_1960/tiles/years_1960.gpkg", delete_dsn = T, quiet = T)
